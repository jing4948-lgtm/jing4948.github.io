<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ê¸‰ ìë¦¬ ë°°ì¹˜ í”„ë¡œê·¸ë¨</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* Override body styles from shared CSS to allow flex layout for this specific app */
        body {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Keep hidden to prevent scroll on body, use internal scroll */
            justify-content: flex-start;
            /* Align to top */
        }

        /* Glass Panel for Sidebar and Header */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-sidebar {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Desk Styles adapted for Dark Mode */
        .desk {
            transition: all 0.3s ease;
            cursor: grab;
            user-select: none;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .desk:active {
            cursor: grabbing;
        }

        .desk.dragging {
            opacity: 0.5;
            border: 2px dashed #3b82f6;
            background-color: rgba(59, 130, 246, 0.2);
        }

        .desk.over {
            border: 2px dashed #f59e0b;
            transform: scale(1.05);
        }

        /* Blackboard */
        .blackboard {
            background-color: #2f4f4f;
            color: white;
            border: 8px solid #5d4037;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        /* Inputs and Buttons */
        .input-glass {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .input-glass:focus {
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            border-color: #a855f7;
        }

        /* Scrollbar override for specific containers */
        #studentListContainer::-webkit-scrollbar {
            width: 6px;
        }

        #studentListContainer::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
    </style>
</head>

<body class="h-screen flex flex-col text-white">

    <!-- ì›€ì§ì´ëŠ” ë¦¬í€´ë“œ ë°°ê²½ -->
    <div class="blob-cont">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <!-- í—¤ë” -->
    <header class="glass-panel p-4 z-10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1
                class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400 title-glow">
                ğŸ« í•™ê¸‰ ìë¦¬ ë°°ì¹˜</h1>
            <div class="text-sm text-gray-300">ë“œë˜ê·¸í•˜ì—¬ ì±…ìƒ ìœ„ì¹˜ ë³€ê²½ -> ë°°ì •í•˜ê¸°</div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative z-10">
        <!-- ì‚¬ì´ë“œë°”: ì„¤ì • ë° í•™ìƒ ëª…ë‹¨ -->
        <aside class="w-80 glass-sidebar flex flex-col shadow-lg z-20">
            <div class="p-4 border-b border-gray-700 bg-white/5">
                <h2 class="font-bold text-lg mb-2 text-purple-300">1. í•™ìƒ ì„¤ì •</h2>
                <div class="flex space-x-2">
                    <input type="number" id="studentCount" placeholder="í•™ìƒ ìˆ˜"
                        class="w-full border border-gray-600 rounded px-3 py-2 bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                        value="20" min="1" max="40">
                    <button onclick="generateInputs()"
                        class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded transition shadow">ìƒì„±</button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4" id="studentListContainer">
                <p class="text-gray-400 text-center mt-10">í•™ìƒ ìˆ˜ë¥¼ ì…ë ¥í•˜ê³ <br>'ìƒì„±' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
            </div>

            <div class="p-4 border-t border-gray-700 bg-white/5">
                <div class="text-xs text-gray-400 mb-2 text-center">ì´ <span id="totalStudents">0</span>ëª…</div>
                <button onclick="assignSeats()"
                    class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 rounded-lg shadow-lg transform transition hover:-translate-y-1">
                    ğŸ² ìë¦¬ ë°°ì •í•˜ê¸°
                </button>
            </div>
        </aside>

        <!-- ë©”ì¸ ì˜ì—­: êµì‹¤ ë°°ì¹˜ë„ -->
        <main class="flex-1 p-8 overflow-auto flex flex-col items-center">

            <!-- ì¹ íŒ ì˜ì—­ -->
            <div
                class="blackboard w-full max-w-3xl h-24 mb-10 flex items-center justify-center rounded text-2xl font-bold tracking-widest relative">
                êµ íƒ
                <div class="absolute bottom-2 right-4 text-xs font-normal opacity-70">Teacher's Desk</div>
            </div>

            <!-- ì±…ìƒ ê·¸ë¦¬ë“œ ì˜ì—­ -->
            <div id="classroomGrid"
                class="grid grid-cols-6 gap-4 mb-10 p-4 border-2 border-dashed border-gray-500 rounded-xl min-w-[800px] bg-white/5">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì±…ìƒì´ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
            <div class="fixed bottom-8 right-8 flex space-x-3">
                <button onclick="resetDesks()"
                    class="bg-gray-700 text-white px-4 py-2 rounded-full shadow hover:bg-gray-600 border border-gray-500">
                    ğŸ”„ ì±…ìƒ ì´ˆê¸°í™”
                </button>
                <button onclick="addColumn()"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-full shadow hover:bg-indigo-700">
                    + ì—´ ì¶”ê°€
                </button>
                <button onclick="removeColumn()"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-full shadow hover:bg-indigo-700">
                    - ì—´ ì‚­ì œ
                </button>
            </div>
        </main>
    </div>

    <!-- Navigation Script -->
    <script src="../js/nav.js"></script>

    <script>
        // --- ë°ì´í„° ë° ìƒíƒœ ---
        let currentCols = 6;
        let currentRows = 4;
        let students = [];

        // ëœë¤ ì´ë¦„ ìƒì„±ì„ ìœ„í•œ ë°ì´í„°
        const lastNames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„', 'í•œ', 'ì˜¤', 'ì„œ', 'ì‹ ', 'ê¶Œ', 'í™©', 'ì•ˆ', 'ì†¡', 'ë¥˜', 'ì „'];
        const firstNames = ['ë¯¼ì¤€', 'ì„œì¤€', 'ë„ìœ¤', 'ì˜ˆì¤€', 'ì‹œìš°', 'í•˜ì¤€', 'ì§€í˜¸', 'ì§€í›„', 'ì¤€ìš°', 'ì¤€ì„œ', 'ì„œìœ¤', 'ì„œì—°', 'ì§€ìš°', 'í•˜ìœ¤', 'ì§€ìœ ', 'ë¯¼ì„œ', 'ì±„ì›', 'í•˜ì€', 'ì§€ì•„', 'ìˆ˜ì•„', 'ì€ì§€', 'ë¯¼ì¬', 'í˜„ìˆ˜', 'ì˜ˆì§„'];

        // --- ì´ˆê¸°í™” ---
        window.onload = function () {
            generateInputs(); // ì´ˆê¸° í•™ìƒ ëª…ë‹¨ ìƒì„±
            renderClassroom(); // ì´ˆê¸° ì±…ìƒ ë°°ì¹˜
        };

        // --- 1. í•™ìƒ ëª…ë‹¨ ìƒì„± ë¡œì§ ---
        function getRandomName() {
            const last = lastNames[Math.floor(Math.random() * lastNames.length)];
            const first = firstNames[Math.floor(Math.random() * firstNames.length)];
            return last + first;
        }

        function generateInputs() {
            const count = document.getElementById('studentCount').value;
            const container = document.getElementById('studentListContainer');
            const totalSpan = document.getElementById('totalStudents');

            container.innerHTML = ''; // ì´ˆê¸°í™”
            students = [];

            for (let i = 0; i < count; i++) {
                const name = getRandomName();
                students.push(name);

                const div = document.createElement('div');
                div.className = "flex items-center mb-2 animate-fade-in";
                div.innerHTML = `
                    <span class="w-8 text-gray-400 text-sm">${i + 1}.</span>
                    <input type="text" class="student-name-input flex-1 border border-gray-600 bg-gray-700 text-white rounded px-2 py-1 text-sm focus:outline-none focus:border-purple-500" value="${name}">
                `;
                container.appendChild(div);
            }
            totalSpan.innerText = count;
        }

        // --- 2. êµì‹¤(ì±…ìƒ) ë Œë”ë§ ë° ì¡°ì‘ ë¡œì§ ---
        function renderClassroom() {
            const grid = document.getElementById('classroomGrid');
            grid.innerHTML = '';

            // ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ì„¤ì • ì—…ë°ì´íŠ¸
            grid.style.gridTemplateColumns = `repeat(${currentCols}, minmax(0, 1fr))`;

            const totalSeats = currentCols * currentRows;

            for (let i = 0; i < totalSeats; i++) {
                const desk = document.createElement('div');
                desk.className = "desk h-24 rounded-lg shadow-sm flex flex-col items-center justify-center relative hover:shadow-md hover:bg-white/20";
                desk.setAttribute('draggable', 'true');
                desk.dataset.index = i; // ì›ë˜ ì¸ë±ìŠ¤ ì €ì¥
                desk.id = `desk-${i}`;

                // ì±…ìƒ ë‚´ìš©
                desk.innerHTML = `
                    <div class="text-xs text-gray-400 absolute top-1 left-2">Wait</div>
                    <div class="student-name font-bold text-lg text-gray-200">-</div>
                `;

                // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì—°ê²°
                addDragEvents(desk);

                grid.appendChild(desk);
            }
        }

        function addColumn() {
            if (currentCols < 10) {
                currentCols++;
                renderClassroom();
            }
        }

        function removeColumn() {
            if (currentCols > 2) {
                currentCols--;
                renderClassroom();
            }
        }

        function resetDesks() {
            currentCols = 6;
            currentRows = 4;
            // ëª¨ë“  ì±…ìƒì˜ ì´ë¦„ ì´ˆê¸°í™”
            const names = document.querySelectorAll('.student-name');
            names.forEach(span => {
                span.innerText = '-';
                span.className = 'student-name font-bold text-lg text-gray-200';
            });
            const status = document.querySelectorAll('.desk div:first-child');
            status.forEach(div => {
                div.innerText = 'Wait';
                div.className = "text-xs text-gray-400 absolute top-1 left-2";
            });
            const desks = document.querySelectorAll('.desk');
            desks.forEach(desk => {
                desk.className = "desk h-24 rounded-lg shadow-sm flex flex-col items-center justify-center relative hover:shadow-md hover:bg-white/20";
                desk.style.background = '';
                desk.style.borderColor = '';
            });
            renderClassroom();
        }

        // --- 3. ë“œë˜ê·¸ ì•¤ ë“œë¡­ (ì±…ìƒ ìœ„ì¹˜ ë³€ê²½) ë¡œì§ ---
        let dragSrcEl = null;

        function addDragEvents(item) {
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragenter', handleDragEnter);
            item.addEventListener('dragover', handleDragOver);
            item.addEventListener('dragleave', handleDragLeave);
            item.addEventListener('drop', handleDrop);
            item.addEventListener('dragend', handleDragEnd);
        }

        function handleDragStart(e) {
            this.classList.add('dragging');
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault(); // ë“œë¡­ í—ˆìš©ì„ ìœ„í•´ í•„ìˆ˜
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            if (this !== dragSrcEl) {
                this.classList.add('over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            // ìê¸° ìì‹ ì´ ì•„ë‹ˆë©´ ë‚´ìš©(ìœ„ì¹˜) êµí™˜
            if (dragSrcEl !== this) {
                const srcHTML = dragSrcEl.innerHTML;
                const destHTML = this.innerHTML;

                dragSrcEl.innerHTML = destHTML;
                this.innerHTML = srcHTML;
            }
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            let items = document.querySelectorAll('.desk');
            items.forEach(function (item) {
                item.classList.remove('over');
            });
        }

        // --- 4. ìë¦¬ ë°°ì • ë¡œì§ ---
        function assignSeats() {
            // 1. í˜„ì¬ ì…ë ¥ëœ í•™ìƒ ëª…ë‹¨ ê°€ì ¸ì˜¤ê¸°
            const inputElements = document.querySelectorAll('.student-name-input');
            let currentStudents = Array.from(inputElements).map(input => input.value).filter(val => val.trim() !== "");

            if (currentStudents.length === 0) {
                alert("í•™ìƒ ëª…ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // 2. ì…”í”Œ (Fisher-Yates Algorithm)
            for (let i = currentStudents.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentStudents[i], currentStudents[j]] = [currentStudents[j], currentStudents[i]];
            }

            // 3. ì±…ìƒ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const desks = Array.from(document.querySelectorAll('.desk'));

            // ê¸°ì¡´ ë°°ì • ì´ˆê¸°í™” ì‹œê° íš¨ê³¼
            desks.forEach(desk => {
                desk.className = "desk h-24 rounded-lg shadow-sm flex flex-col items-center justify-center relative hover:shadow-md hover:bg-white/20";
                desk.querySelector('.student-name').innerText = '';
            });

            // 4. ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ì™€ í•¨ê»˜ ë°°ì •
            let studentIndex = 0;

            // íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆœì°¨ì ìœ¼ë¡œ ì´ë¦„ ê³µê°œ
            let interval = setInterval(() => {
                if (studentIndex >= currentStudents.length || studentIndex >= desks.length) {
                    clearInterval(interval);
                    // ë‚¨ì€ ë¹ˆ ì±…ìƒ ì²˜ë¦¬
                    for (let i = studentIndex; i < desks.length; i++) {
                        const statusDiv = desks[i].querySelector('div:first-child');
                        statusDiv.innerText = "ë¹ˆ ìë¦¬";
                        desks[i].querySelector('.student-name').innerText = "-";
                    }
                    return;
                }

                const desk = desks[studentIndex];
                const studentName = currentStudents[studentIndex];

                // ìŠ¤íƒ€ì¼ ë³€ê²½ (Highlight)
                desk.style.background = 'rgba(34, 197, 94, 0.2)'; // Green tint
                desk.style.borderColor = '#4ade80';
                desk.classList.add('transform', 'scale-105');

                // í…ìŠ¤íŠ¸ ë³€ê²½
                const statusDiv = desk.querySelector('div:first-child');
                statusDiv.innerText = `No.${studentIndex + 1}`;
                statusDiv.className = "text-xs text-green-400 font-bold absolute top-1 left-2";

                const nameDiv = desk.querySelector('.student-name');
                nameDiv.innerText = studentName;
                nameDiv.className = "student-name font-bold text-lg text-green-300";

                // ìŠ¤ì¼€ì¼ íš¨ê³¼ ì›ë³µ
                setTimeout(() => {
                    desk.classList.remove('scale-105');
                }, 200);

                studentIndex++;
            }, 100); // 0.1ì´ˆë§ˆë‹¤ í•œ ëª…ì”© ë°°ì •
        }
    </script>
</body>

</html>